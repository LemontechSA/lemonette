/*! lemontend 2014-10-21 */
(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Function.prototype.include=function(a){var b,c,d;d=a.prototype;for(b in d)c=d[b],this.prototype[b]=c;return this},function(a){return _.extend(a.Marionette.Application.prototype,{defaultData:{host:"localhost",api_url:"http://localhost:3000",ws_endpoint:"http://localhost:3000/faye",current_user:null,api_token:null,default_lang:"es"},bootstrap:function(a){var b;return b=window.bootstrap_data||this.defaultData,b[a]},navigate:function(b,c){return null==c&&(c={}),a.history.navigate(b,c)},getCurrentRoute:function(){var b;return b=a.history.fragment,_.isEmpty(b)?null:b},startHistory:function(){return a.history?a.history.start():void 0},register:function(a,b){return null==this._registry&&(this._registry={}),this._registry[b]=a},unregister:function(a,b){return delete this._registry[b]},resetRegistry:function(){var a,b,c,d,e;d=this.getRegistrySize(),e=this._registry;for(b in e)a=e[b],a.region.close();return c="There were "+d+" controllers in the registry, there are now "+this.getRegistrySize(),this.getRegistrySize()>0?console.warn(c,this._registry):console.log(c)},getRegistrySize:function(){return _.size(this._registry)},log:function(){return function(a,b,c){return this.debug&&this.debug<c?void 0:"string"!=typeof a?console.log("Object("+b+")",a):console.log((b?"("+b+") ":"")+a)}}})}(Backbone),function(a,b){"function"==typeof define&&define.amd?define(["underscore","backbone"],function(c,d){return a.Backbone=b(c,d)}):a.Backbone=b(a._,a.Backbone)}(this,function(a,b){var c,d,e,f,g,h,i,j,k;return g=function(c,d,e){var f,g;d=d||{},g=a.isFunction(c.url)?c.url():c.url,f=!1,g&&d.cache!==!1&&(d.cache||d.prefill)&&(d.expires!==!1&&(f=(new Date).getTime()+1e3*(d.expires||300)),b.fetchCache._cache[g]={created:(new Date).getTime(),expires:f,value:e},b.fetchCache.setLocalStorage())},e=function(c){var d;return d=a.isFunction(c.url)?c.url():c.url,d?b.fetchCache._cache[d]:null},k=function(a,b,c){var d;b=b||{},b.cache=!0,d=e(a),d&&!b.hasOwnProperty("expires")&&(b.expires=d.expires?(d.expires-d.created)/1e3:!1),g(a,b,c)},d=function(a){var b;return b=e(a),b?b.created:null},c=function(a){delete b.fetchCache._cache[a],b.fetchCache.setLocalStorage()},h=function(){var a,c;if(j&&b.fetchCache.localStorage)try{localStorage.setItem("backboneCache",JSON.stringify(b.fetchCache._cache))}catch(d){if(c=d,a=c.code||c.number||c.message,22!==a)throw c;this._deleteCacheWithPriority()}},f=function(){var a;j&&b.fetchCache.localStorage&&(a=localStorage.getItem("backboneCache")||"{}",b.fetchCache._cache=JSON.parse(a))},i={modelFetch:b.Model.prototype.fetch,modelSync:b.Model.prototype.sync,collectionFetch:b.Collection.prototype.fetch},j="undefined"!=typeof window.localStorage,b.fetchCache=b.fetchCache||{},b.fetchCache._cache=b.fetchCache._cache||{},b.fetchCache.priorityFn=function(a,b){return a&&a.expires&&b&&b.expires?a.expires-b.expires:a},b.fetchCache._prioritize=function(){var b,c;return c=a.values(this._cache).sort(this.priorityFn),b=a.indexOf(a.values(this._cache),c[0]),a.keys(this._cache)[b]},b.fetchCache._deleteCacheWithPriority=function(){b.fetchCache._cache[this._prioritize()]=null,delete b.fetchCache._cache[this._prioritize()],b.fetchCache.setLocalStorage()},"undefined"==typeof b.fetchCache.localStorage&&(b.fetchCache.localStorage=!0),b.Model.prototype.cacheTime=function(){return d(this)},b.Collection.prototype.cacheTime=function(){return d(this)},b.Model.prototype.updateCache=function(a){k(this,a,this.attributes)},b.Collection.prototype.updateCache=function(b){k(this,b,a.map(this.models,function(a){return a.attributes}))},b.Model.prototype.fetch=function(c){var d,e,f,g,h;if(c=c||{},h=a.isFunction(this.url)?this.url():this.url,e=b.fetchCache._cache[h],f=!1,d=!1,g=new $.Deferred,e&&(f=e.expires,f=f&&e.expires<(new Date).getTime(),d=e.value),!f&&(c.cache||c.prefill)&&d){if(this.set(this.parse(d),c),a.isFunction(c.prefillSuccess)&&c.prefillSuccess(this,d,c),this.trigger("cachesync",this,d,c),this.trigger("sync",this,d,c),!c.prefill)return a.isFunction(c.success)&&c.success(this),g.resolve(this);g.notify(this)}return i.modelFetch.apply(this,arguments).done(a.bind(g.resolve,this,this)).done(a.bind(b.fetchCache.setCache,null,this,c)).fail(a.bind(g.reject,this,this)),g},b.Model.prototype.sync=function(b,d){var e,f,g,h;if("read"===b)return i.modelSync.apply(this,arguments);for(e=d.collection,g=[],f=void 0,h=void 0,g.push(a.isFunction(d.url)?d.url():d.url),e&&g.push(a.isFunction(e.url)?e.url():e.url),f=0,h=g.length;h>f;)c(g[f]),f++;return i.modelSync.apply(this,arguments)},b.Collection.prototype.fetch=function(c){var d,e,f,g,h;if(c=c||{},h=a.isFunction(this.url)?this.url():this.url,e=b.fetchCache._cache[h],f=!1,d=!1,g=new $.Deferred,e&&(f=e.expires,f=f&&e.expires<(new Date).getTime(),d=e.value),!f&&(c.cache||c.prefill)&&d){if(this[c.reset?"reset":"set"](this.parse(d),c),a.isFunction(c.prefillSuccess)&&c.prefillSuccess(this,d,c),this.trigger("cachesync",this,d,c),this.trigger("sync",this,d,c),!c.prefill)return a.isFunction(c.success)&&c.success(this),g.resolve(this);g.notify(this)}return i.collectionFetch.apply(this,arguments).done(a.bind(g.resolve,this,this)).done(a.bind(b.fetchCache.setCache,null,this,c)).fail(a.bind(g.reject,this,this)),g},f(),b.fetchCache._superMethods=i,b.fetchCache.setCache=g,b.fetchCache.clearItem=c,b.fetchCache.setLocalStorage=h,b.fetchCache.getLocalStorage=f,b}),function(a,b,c){return a.registerHelper("t",function(c){var d;return d=b.t(c),new a.SafeString(d)}),a.registerHelper("dt",function(b,d,e){return new a.SafeString(c(e[b]).format(d))}),a.registerHelper("hm",function(b,d){return new a.SafeString(c().startOf("day").add(parseInt(d[b]),"m").format("HH:mm"))}),a.registerHelper("p",function(b,c){return new a.SafeString(JST[b](c))}),a.registerHelper("input",function(b,c){return c.hash&&(c=c.hash),c.wrapper_class||(c.wrapper_class="sm-2"),"select"===c.type&&c.collection.fetch(),new a.SafeString(JST["shared/inputs/"+b](c))})}(Handlebars,i18n,moment),this.App.module("Ajax",function(a,b,c,d,e){return a.addInitializer(function(){return e(document).ajaxError(function(a,c){try{if(c.status>400)return b.execute("alert.show",{title:"No autorizado",message:JSON.parse(c.responseText).message})}catch(d){return console.log("Ajax Error")}})})}),this.App.module("Shared",function(a,b,c,d,e,f){return a.AutoFillable=function(){function a(){}return a.prototype.fillRelation=function(a,c,d,f,g,h){return null==h&&(h={}),"string"==typeof a&&(a=b.Models.collection(a)),a[d]=f?e(f.target).val():g,this.fillSelect(a,c,h)},a.prototype.fillSelect=function(a,c,d){var f,g;return null==d&&(d={}),d=e.extend({persistent:!0,cache:!0,prefill:!0},d),"string"==typeof a&&(a=b.Models.collection(a)),g="function"==typeof a.url?a.url():a.url,d.persistent&&a.fetchedUrl===g?this.createOptionsFromCollection(a,c,d):(f=function(b){return function(){return a.fetchedUrl=g,b.createOptionsFromCollection(a,c,d)}}(this),d.cache?a.cacheFetch({success:f},!0):a.prefillFetch({prefill:d.prefill,success:f},!0))},a.prototype.createOptionsFromCollection=function(a,b,c){var d,f;return null==c&&(c={}),d={selected_value:null,name_field:"name",default_value:null,persistent:!0},c=e.extend(d,c),f=[],a.each(function(b){var d;return c.filter&&!c.filter(b,a)||(d="string"==typeof c.name_field?b.get(c.name_field):c.name_field(b),d={id:b.id,value:d},f.push(d),"function"!=typeof c.default_value||!c.default_value(b))?void 0:c.default_value=b.id}),this.createOptions(b,f,c.selected_value,c.default_value,c)},a.prototype.createOptions=function(a,b,c,d,g){var h,i;return null==c&&(c=null),null==d&&(d=null),null==g&&(g={}),0===f.keys(g).length&&(h={selected_value:null,name_field:"name",default_value:null,persistent:!0},g=e.extend(h,g)),null===d&&this.default_values&&this.default_values[a]&&(d=this.default_values[a]),null===c&&(c=this.model&&(this.model.id||this.model.get(a))?this.model.get(a):d),c+="",i=g.element||this.$("#"+a),0===i.length&&(i=e("#"+a)),i.find("option").remove(),i.append(e("<option/>",{val:"",text:"Seleccione..."})),e.each(b,function(a,b){var d;return d={val:b.id||a,text:b.value||b},parseInt(c,10)===parseInt(b.id||a,10)&&(d.selected="selected"),i.append(e("<option/>",d))}),i.change()},a.prototype.fillModel=function(a,b){var c,d;return null==a&&(a={}),null==b&&(b=!1),d=a.model||this.model,c=a.inputs||this.$("[name]"),b||this.validateInputs(c)?(c.each(function(){var b,c,f,g,h,i;if(c=e(this).attr("name"),i=e(this).val(),""===i&&"SELECT"===this.tagName?i=null:"checkbox"===e(this).attr("type")?i=e(this).is(":checked"):e(this).data("datefield")&&(b=e("[data-datefield="+c+"].datetime-date").val().replace(/^(\d{1,2})\D(\d{1,2})\D(\d{4})$/,"$3-$2-$1").split("-"),h=e("[data-datefield="+c+"].datetime-time"),g=(h.val()||h.data("empty_time")||"00:00").split(":"),i=new Date(b[0],b[1]-1,b[2],g[0],g[1]).toISOString()),a.beforeSet){if(f=a.beforeSet(this,d,i,c),!f)return!0;"object"==typeof f&&(f.field&&(c=f.field),f.value&&(i=f.value))}return d.set(c,i),a.afterSet?a.afterSet(this,d,i,c):void 0}),d):null},a}()}),this.App.module("Shared",function(a,c,e,f,g){return a.CacheableCollection=function(a){function c(){return this.cacheFetch=b(this.cacheFetch,this),c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.initialize=function(){return this.removedItems={},this.on("remove",function(a){return function(b){return b.id?a.removedItems[b.id]=b:void 0}}(this))},c.prototype.syncItems=function(a){return null==a&&(a=void 0),g.each(this.removedItems,function(a){return function(b,c){return c.urlRoot=a.url(),c.destroy()}}(this)),this.removedItems={},this.each(function(b){return function(c){var d;return c.id?c.save():(d={},g.isFunction(a)&&(d={success:a}),b.create(c,d))}}(this)),this},c.prototype.prefillFetch=function(a,b){var c,d;return null==a&&(a={}),d=!1,c=g.extend({prefill:!0,expires:2592e3},a),a.success&&(c.prefillSuccess=function(b,c,e){return d=!0,a.success(b,c,e)},c.success=function(c,e,f){return b||!d?a.success(c,e,f):void 0}),this.fetch(c)},c.prototype.cacheFetch=function(a,b){var c,d,e;return null==a&&(a={}),c=g.extend({cache:!0,expires:2592e3},a),d=this.cacheTime(),this.fetch(c),d?(e="function"==typeof this.url?this.url():this.url,e+="/updated?ts="+d/1e3,this.query&&"function"==typeof this.query&&(e+="&"+this.query()),g.ajax(e,{success:function(d){return function(e){var f;return d.set(e.results,{add:!0,merge:!0,remove:!1}),d.remove(d.filter(function(a){return e.ids.indexOf(a.id)<0})),f=function(){return d.updateCache({expires:c.expires}),a.success&&b?a.success(d,e,a):void 0},d.length<e.ids.length?d.fetch({success:function(){return f()}}):f()}}(this)})):void 0},c.prototype.resetFetched=function(a){return this.reset(a),this.fetchedUrl=this.url},c}(e.Collection)}),this.App.module("Shared",function(a,b,c,e,f,g){var h;return h=function(a,b){return this._outstandingId=a,this._awaitCount=b.length,g.each(b,function(a){return this.listenToOnce(a,"sync error",this._onModelSync)},this)},g.extend(h.prototype,c.Events,{_onModelSync:function(a){return a.id===this._outstandingId?(this.trigger("found",a),this.stopListening()):0===--this._awaitCount?(this.stopListening(),this.trigger("notfound")):void 0}}),a.LiveCollection=function(a){function e(a,d){c.Collection.prototype.constructor.call(this,a,d),b.fayeClient&&(this.subscription=b.fayeClient.subscribe(this.channel,this._fayeEvent,this))}return d(e,a),e.prototype._fayeEvent=function(a){var b,c;switch(c=a.method,b=a.body,c){case"POST":return this._createEvent(b);case"PUT":return this._updateEvent(b);case"DELETE":return this._removeEvent(b);default:return console.log("Unknown realtime event",a)}},e.prototype._createEvent=function(a){var b,c,d,e;return console.log("live: Create event",a),b=this._getModelId(a),this.get(b)?this._updateEvent(a):(c=this.model.prototype.idAttribute,e=this.filter(function(a){return!a.id}),e.length?(console.log("live: awaiting syncs of unsaved objects"),d=new h(b,e),d.once("notfound",function(){return this.add(a,{parse:!0})},this)):(console.log("live: adding immediately"),this.add(a,{parse:!0})))},e.prototype._updateEvent=function(a){var b,c,d;return console.log("live: Update event",a),c=this._getModelId(a),d=new this.model(a,{parse:!0}),b=this.get(c),b?b.set(d.attributes):this.add(d)},e.prototype._removeEvent=function(a){var b;return console.log("live: Remove event",a),b=this._getModelId(a),this.remove(b)},e.prototype._getModelId=function(a){return a[this.model.prototype.idAttribute]},e}(c.Collection)}),this.App.module("Date",function(a,b,c,d,e,f,g,h){return a.D=function(){function b(a){(a instanceof String||"string"==typeof a)&&(this._d=h(a)),a instanceof Date&&(this._d=h(a)),a||(this._d=h(new Date)),"object"==typeof a._d&&(this._d=a)}return b.prototype._d={},b.prototype.toString=function(a){return null==a&&(a="YYYY-MM-DD"),this._d.format(a)},b.prototype.isToday=function(){return this._d.isSame(h().format("YYYY-MM-DD"))},b.prototype.startOfWeek=function(){return new a.D(this._d.startOf("isoWeek").format("YYYY-MM-DD"))},b.prototype.endOfWeek=function(){return new a.D(this._d.endOf("isoWeek").format("YYYY-MM-DD"))},b.prototype.date=function(){return this._d._d},b.prototype.s=function(a){return null==a&&(a="YYYY-MM-DD"),this.toString(a)},b.prototype.d=function(){return this.date()},b}()},i18n.t,moment),a=a||null,this.App.module("Utils",function(a,b,c,d,e,f,g,h,i,j){return a.SpellChecker=function(a,b){var c;return h?void alert("You must add lemontend.spell.js to use Utils.SpellChecker"):(b=b||{},b.server_url="/spell",c=new h(b),c.decorateTextarea(a),c)},a.secondsToHHMMSS=function(a){var b,c;return b=Math.floor(a/3600),a%=3600,c=Math.floor(a/60),a%=60,10>b&&(b="0"+b),10>c&&(c="0"+c),10>a&&(a="0"+a),{hh:b,mm:c,ss:a}},a.minutesToHHMM=function(b){var c;return c=a.secondsToHHMMSS(60*b),""+c.hh+":"+c.mm},a.showHelp=function(a,b){var c;return null==b&&(b=!1),this.showing&&!b||e.cookie("visited"+a)&&!b?void 0:(c=j(),c.setOptions({disableInteraction:!0}),c.goToStep(a).start(),c.onexit(function(a){return function(){return a.showing=!1}}(this)),e.cookie("visited"+a,1),this.showing=1)}},i18n.t,a,toastr,introJs),TimeBilling.module("Notifications",function(a,b,c,d,e,f,g,h){return this.startWithParent=!1,a.addInitializer(function(){return b.commands.setHandler("alert.show",function(a){var b;return b={positionClass:"toast-top-center",type:a.type||"warning",message:a.message||"You must provide a message",success:a.success,showMethod:"slideDown",newestOnTop:!0,title:"Información Importante"},e.extend(b,a),Utils.showMessage(b)}),b.commands.setHandler("info.show",function(a){var b;return b={positionClass:"toast-top-center",type:a.type||"info",message:a.message||"You must provide a message",success:a.success,newestOnTop:!1},e.extend(b,a),Utils.showMessage(b)})}),a.showMessage=function(a){return null==a&&(a={}),h.options.positionClass=a.positionClass,h.options.extendedTimeOut=a.extendedTimeOut,h.options.timeOut=a.timeOut,h.options.hideDuration=a.hideDuration||200,h.options.extendedTimeOut=a.extendedTimeOut||1e5,h.options.timeOut=a.timeOut||5e3,h.options.showDuration=a.showDuration||200,h.options.closeButton=a.closeButton||!0,h.options.newestOnTop=a.newestOnTop,h.options.showMethod=a.showMethod,h.options.onclick=function(){return h.clear(),a.onclick()},h.options.hideMethod=a.hideMethod||"slideUp",h.clear(),h[a.type](a.message,a.title),e(".toast .action").on("click",function(){var b;return h.clear(),b=e(this).data("callback"),b&&a[b]?a[b]():void 0})}},i18n.t,toastr),this.App.module("Controllers",function(a,b,c,e,f,g){return a.Base=function(a){function c(a){null==a&&(a={}),this.region=a.region||b.request("default:region"),this._instance_id=g.uniqueId("controller"),b.execute("register:instance",this,this._instance_id),c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.close=function(){return b.execute("unregister:instance",this,this._instance_id),c.__super__.close.apply(this,arguments)},c.prototype.show=function(a,b){return null==b&&(b={}),g.defaults(b,{loading:!1,region:this.region}),this._setMainView(a),this._manageView(a,b)},c.prototype._setMainView=function(a){return this._mainView?void 0:(this._mainView=a,this.listenTo(a,"close",this.close))},c.prototype._manageView=function(a,c){return c.loading?b.execute("show:loading",a,c):c.region.show(a)},c}(e.Controller)}),this.App.module("Routers",function(a,b,c,e){return a.TrackableRouter=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.on("route",function(a,b){return console.log("tracking route "+a),console.log("tracking options "+b)})}return d(b,a),b}(e.AppRouter)}),this.App.module("Views",function(a,b,c,d,e,f){return f.extend(d.View.prototype,{genericThing:function(){return console.log("generic thing for views :)")}})}),this.App.module("Views",function(a,b,c,e){return a.CollectionView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b.prototype.itemViewEventPrefix="childview",b}(e.CollectionView)}),this.App.module("Views",function(a,b,c,e){return a.CompositeView=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.itemViewEventPrefix="childview",c.prototype.onShow=function(){return this.help_step>0?b.Utils.showHelp(this.help_step):void 0},c}(e.CompositeView)}),this.App.module("Views",function(a,b,c,e){return a.ItemView=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.onShow=function(){return this.help_step>0?b.execute("help:show",this.help_step):void 0},c}(e.ItemView)}),this.App.module("Views",function(a,b,c,e){return a.Layout=function(b){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,b),a.BackboneView=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return d(b,a),b}(c.View),e}(e.Layout)})}).call(this);